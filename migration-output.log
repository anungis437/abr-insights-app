[dotenv@17.2.3] injecting env (26) from .env.local -- tip: ğŸ” prevent building .env in docker: https://dotenvx.com/prebuild
âœ… Connected to database

ğŸš€ Applying Database Migrations...

Found 48 migration files

â­ï¸  000_enable_extensions.sql - Already applied
â­ï¸  001_initial_schema.sql - Already applied
â­ï¸  002_rls_policies.sql - Already applied
â­ï¸  003_content_tables.sql - Already applied
ğŸ“„ Applying 004_user_engagement.sql...
âŒ 004_user_engagement.sql - Failed:
   column "organization_id" does not exist

ğŸ“„ Applying 010_seed_data.sql...
âŒ 010_seed_data.sql - Failed:
   null value in column "requirement_type" of relation "achievements" violates not-null constraint

â­ï¸  011_newsletter_subscribers.sql - Already applied
â­ï¸  012_tribunal_case_stats_rpc.sql - Already applied
â­ï¸  013_testimonials.sql - Already applied
â­ï¸  014_add_role_to_profiles.sql - Already applied
â­ï¸  015_ai_training_system.sql - Already applied
ğŸ“„ Applying 016_rbac_test_accounts.sql...
âŒ 016_rbac_test_accounts.sql - Failed:
   insert or update on table "profiles" violates foreign key constraint "profiles_id_fkey"

â­ï¸  017_courses_enhancement_phase1.sql - Already applied
ğŸ“„ Applying 018_courses_enhancement_rls.sql...
âŒ 018_courses_enhancement_rls.sql - Failed:
   policy "Public can view published modules" for table "course_modules" already exists

ğŸ“„ Applying 018_permission_check_functions.sql...
âŒ 018_permission_check_functions.sql - Failed:
   function name "public.check_user_permission" is not unique

ğŸ“„ Applying 019_ai_usage_logging.sql...
âŒ 019_ai_usage_logging.sql - Failed:
   relation "idx_ai_usage_logs_user_id" already exists

ğŸ“„ Applying 019_courses_gamification.sql...
âŒ 019_courses_gamification.sql - Failed:
   relation "idx_course_points_transactions_user_course" already exists

â­ï¸  020_comprehensive_permissions_seed.sql - Already applied
ğŸ“„ Applying 021_permission_based_rls_functions.sql...
âŒ 021_permission_based_rls_functions.sql - Failed:
   permission denied for schema auth

â­ï¸  021_permission_based_rls_functions_v2.sql - Already applied
ğŸ“„ Applying 022_migrate_critical_table_rls.sql...
âŒ 022_migrate_critical_table_rls.sql - Failed:
   policy "profiles_select_own" for table "profiles" already exists

ğŸ“„ Applying 023_migrate_feature_table_rls.sql...
âŒ 023_migrate_feature_table_rls.sql - Failed:
   policy "enrollments_select_own" for table "enrollments" already exists

ğŸ“„ Applying 023_migrate_feature_table_rls_FIXED.sql...
âŒ 023_migrate_feature_table_rls_FIXED.sql - Failed:
   policy "enrollments_insert_self" for table "enrollments" already exists

â­ï¸  20250108000001_enable_pgvector.sql - Already applied
ğŸ“„ Applying 20250108000002_create_embeddings_tables.sql...
âŒ 20250108000002_create_embeddings_tables.sql - Failed:
   policy "case_embeddings_select_policy" for table "case_embeddings" already exists

â­ï¸  20250108000003_create_similarity_functions.sql - Already applied
ğŸ“„ Applying 20250108000004_create_outcome_prediction.sql...
âŒ 20250108000004_create_outcome_prediction.sql - Failed:
   policy "case_outcomes_select_policy" for table "case_outcomes" already exists

ğŸ“„ Applying 20250115000001_lesson_notes.sql...
âŒ 20250115000001_lesson_notes.sql - Failed:
   relation "idx_lesson_notes_user_lesson" already exists

ğŸ“„ Applying 20250115000002_watch_history.sql...
âŒ 20250115000002_watch_history.sql - Failed:
   relation "idx_watch_history_user_date" already exists

ğŸ“„ Applying 20250115000003_quiz_system.sql...
âŒ 20250115000003_quiz_system.sql - Failed:
   type "question_type" already exists

ğŸ“„ Applying 20250115000004_certificates.sql...
âŒ 20250115000004_certificates.sql - Failed:
   type "certificate_type" already exists

â­ï¸  20250115000005_ce_credit_tracking.sql - Already applied
ğŸ“„ Applying 20250115000006_skills_validation.sql...
âŒ 20250115000006_skills_validation.sql - Failed:
   type "proficiency_level" already exists

ğŸ“„ Applying 20250115000007_course_workflow.sql...
âŒ 20250115000007_course_workflow.sql - Failed:
   type "workflow_status" already exists

ğŸ“„ Applying 20250115000008_instructor_portal.sql...
âŒ 20250115000008_instructor_portal.sql - Failed:
   type "instructor_status" already exists

ğŸ“„ Applying 20250116000001_enterprise_sso_auth.sql...
âŒ 20250116000001_enterprise_sso_auth.sql - Failed:
   policy "Organization admins can manage SSO providers" for table "sso_providers" already exists

ğŸ“„ Applying 20250116000002_advanced_rbac.sql...
âŒ 20250116000002_advanced_rbac.sql - Failed:
   policy "Admins can manage resource permissions" for table "resource_permissions" already exists

ğŸ“„ Applying 20250116000003_audit_logs_enhancement.sql...
âŒ 20250116000003_audit_logs_enhancement.sql - Failed:
   policy "Admins can manage compliance reports" for table "compliance_reports" already exists

ğŸ“„ Applying 20250116000004_ingestion_pipeline.sql...
âŒ 20250116000004_ingestion_pipeline.sql - Failed:
   constraint "fk_tribunal_cases_raw_job" for relation "tribunal_cases_raw" already exists

ğŸ“„ Applying 20250116000005_migrate_gamification_schema.sql...
âŒ 20250116000005_migrate_gamification_schema.sql - Failed:
   relation "user_points_transactions_legacy" already exists

ğŸ“„ Applying 20250116000006_gamification_social.sql...
âŒ 20250116000006_gamification_social.sql - Failed:
   policy "user_profiles_extended_select" for table "user_profiles_extended" already exists

ğŸ“„ Applying 20250116000007_comprehensive_demo_seed.sql...
âŒ 20250116000007_comprehensive_demo_seed.sql - Failed:
   duplicate key value violates unique constraint "courses_slug_key"

ğŸ“„ Applying 20250117000001_cleanup_test_users.sql...
âœ… 20250117000001_cleanup_test_users.sql - Applied successfully

ğŸ“„ Applying 20250117000002_fix_profiles_rls_recursion.sql...
âœ… 20250117000002_fix_profiles_rls_recursion.sql - Applied successfully

ğŸ“„ Applying 20250117000003_fix_profiles_rls_simple.sql...
âœ… 20250117000003_fix_profiles_rls_simple.sql - Applied successfully

ğŸ“„ Applying 20250117000004_fix_remaining_recursive_policies.sql...
âœ… 20250117000004_fix_remaining_recursive_policies.sql - Applied successfully

ğŸ“„ Applying cleanup_incomplete_tables.sql...
âœ… cleanup_incomplete_tables.sql - Applied successfully

ğŸ“„ Applying manual_missing_tables.sql...
âŒ manual_missing_tables.sql - Failed:
   policy "Users can view their own chat sessions" for table "ai_chat_sessions" already exists


============================================================
ğŸ“Š Migration Summary:
============================================================
âœ… Applied: 5
â­ï¸  Skipped: 15
âŒ Failed: 28
ğŸ“ Total: 48
============================================================

âš ï¸  Some migrations failed. Check errors above.

